function runPostAbstract(){if(!document.querySelector("#post #article-container"))return;let e=document.getElementById("abstract-content").innerText,t=-1,n=!0;const r=document.querySelector("#abstract-content"),c=document.querySelector("#abstract-content");let i="",a="",l=600,o=0,s=0,d=[],m=0;const u=e=>{if(n)if(u.start||(u.start=e),m=e-u.start,m>=20){if(u.start=e,o<a-1){let e=i.charAt(o+1),t=/[,.，。!?！？]/.test(e)?150:20;r.firstElementChild&&r.removeChild(r.firstElementChild),r.innerHTML+=e;let n=document.createElement("div");n.className="ai-cursor",r.appendChild(n),o++,150===t&&(document.querySelector("#abstract-content .ai-cursor").style.opacity="0"),o===a-1&&(h.disconnect(),r.removeChild(r.firstElementChild)),d[0]=setTimeout((()=>{requestAnimationFrame(u)}),t)}}else requestAnimationFrame(u)},h=new IntersectionObserver((e=>{let t=e[0].isIntersecting;n=t,n&&(l=0===o?200:20,d[1]=setTimeout((()=>{s&&(o=0,s=0),0===o&&(r.innerHTML=i.charAt(0)),requestAnimationFrame(u)}),l))}),{threshold:0});function f(){d.length&&d.forEach((e=>{e&&clearTimeout(e)}))}function v(e,t=!0){o=0,s=1,f(),n=!1,m=0,h.disconnect(),r.innerHTML=t?"生成中. . .":"请等待. . .",i=e,a=i.length,h.observe(c)}async function E(){o=0,s=1,f(),n=!1,m=0,h.disconnect();const r=e.split(",").map((e=>e.trim()));if(1!==r.length){let e=Math.floor(Math.random()*r.length);for(;e===t;)e=Math.floor(Math.random()*r.length);t=e,v(r[e])}else v(r[0])}function y(){v("我是文章摘要助手，是一个基于文章元数据的摘要生成器，在不久的将来我会进化为基于大模型的版本哟~ 点击下方的按钮，让我为你生成本文简介、推荐相关文章吧~")}document.getElementById("abstract-tag").addEventListener("click",(()=>{y()})),document.getElementById("abstract-intro").addEventListener("click",(()=>{y()})),document.getElementById("abstract-generate").addEventListener("click",(()=>{E()})),document.getElementById("abstract-recommend").addEventListener("click",(()=>{o=0,s=1,f(),n=!1,m=0,r.innerHTML="生成中. . .",i="",a="",h.disconnect(),d[2]=setTimeout((()=>{r.innerHTML=function(){let e=document.querySelectorAll(".relatedPosts-list a");var t=document.title;let n="",r=0;if(!e.length){const c=document.querySelector(".card-widget.card-recent-post");return c?(e=c.querySelectorAll(".aside-list-item a"),e.length>0&&e.forEach((e=>{e&&(t.includes(e.title)||(r+=1,n+=`<div class="ai-recommend-item"><span class="index">${o+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${e.href}')" title="${e.title}">${e.title}</a></div>`))})),`很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class="ai-recommend">${n}</div>`):""}return e.forEach((e=>{e&&(t.includes(e.title)||(r+=1,n+=`<div class="ai-recommend-item"><span>推荐${r}：</span><a href="javascript:;" onclick="pjax.loadUrl('${e.href}')" title="${e.title}">${e.title}</a></div>`))})),`推荐文章:<br /><div class="ai-recommend">${n}</div>`}()}),600)})),document.getElementById("abstract-home").addEventListener("click",(()=>{v("正在前往主页...",!1),d[2]=setTimeout((()=>{pjax.loadUrl("/")}),1e3)})),document.getElementById("abstract-hide").addEventListener("click",(()=>{document.getElementById("abstract-container").style.display="none"})),E()}