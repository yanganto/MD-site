window.addEventListener("load",(()=>{const e=document.getElementById("search-mask"),t=document.querySelector("#site-search .search-dialog"),i=()=>{if(btf.animateIn(e,"to_show 0.5s"),t.style.display="block",setTimeout((()=>{document.querySelector("#site-search .ais-SearchBox-input").focus()}),100),document.addEventListener("keydown",(function e(t){"Escape"===t.code&&(s(),document.removeEventListener("keydown",e))})),n(),window.addEventListener("resize",n),!searchLibLoaded){searchLibLoaded=!0;const e=document.getElementsByClassName("ais-SearchBox-input")[0];e.disabled=!0,loadFiles(searchFiles,(()=>{l(),e.disabled=!1}))}};GLOBAL_CONFIG.keyboard&&window.addEventListener("keydown",(function(e){if(83==e.keyCode&&e.shiftKey){if(console.info(selectTextNow),selectTextNow){i();const e=document.querySelector("#site-search-input > div > form > input");e.value=selectTextNow,e.dispatchEvent(new Event("input")),setTimeout((()=>{document.querySelector("#site-search-input > div > form > button.ais-SearchBox-submit").click()}),64)}else i();return!1}}));const s=()=>{btf.animateOut(t,"search_close .5s"),btf.animateOut(e,"to_hide 0.5s"),window.removeEventListener("resize",n)},n=()=>{window.innerWidth<768&&t.style.setProperty("--search-height",window.innerHeight+"px")},a=()=>{btf.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",i)},l=()=>{const e=GLOBAL_CONFIG.search;var t,i;if("algolia"==e.engine){const s=e.algolia;if(!(s.appId&&s.apiKey&&s.indexName))return console.error("Algolia Search setting is invalid!");t=algoliasearch(s.appId,s.apiKey),i=s.indexName}else if("meilisearch"==e.engine){const s=e.meilisearch;if(!(s.host&&s.apiKey&&s.indexName))return console.error("Algolia Search setting is invalid!");t=instantMeiliSearch(s.host,s.apiKey).searchClient,i=s.indexName}const s=instantsearch({indexName:i,searchClient:t,searchFunction(e){if(e.state.query){let t='<i class="icon-spinner spin"></i>';document.getElementById("algolia-hits").innerHTML=t,e.search()}}}),n=instantsearch.widgets.configure({hitsPerPage:e.hits.per_page??5}),a=instantsearch.widgets.searchBox({container:"#site-search-input",showReset:!1,showSubmit:!1,placeholder:e.languages.input_placeholder,showLoadingIndicator:!0,searchOnEnterKeyPressOnly:!0,searchAsYouType:!0}),l=instantsearch.widgets.hits({container:"#algolia-hits",transformItems:t=>{if("algolia"==e.engine)return t;const i={};return t.forEach((e=>{const t=e.hierarchy_lvl2||"Uncategorized";i[t]||(i[t]={category:e.hierarchy_lvl0?e._highlightResult.hierarchy_lvl0.value:"",tag:e.hierarchy_lvl1?e._highlightResult.hierarchy_lvl1.value:"",title:e.hierarchy_lvl2?e._highlightResult.hierarchy_lvl2.value:"",url:e.url.split("#")[0],description:e.hierarchy_lvl3&&e.hierarchy_lvl3!==e._highlightResult.hierarchy_lvl3.value?e._highlightResult.hierarchy_lvl3.value:"",items:[]}),i[t].items.push(e)})),Object.values(i)},templates:{item(t,{html:i,components:s}){const n=document.querySelector("#algolia-hits .icon-spinner");return n&&(n.style.display="none"),setTimeout((()=>{document.querySelector("#site-search .ais-SearchBox-input").focus()}),200),console.log(t),"meilisearch"==e.engine?function(e,{html:t,components:i}){const s=e,n=e.items;return`\n          <div class="search-result-group">\n              <a href="${s.url}" class="algolia-hit-item-link search-result-title">\n                  ${s.title?'<i class="icon-book-open"></i>':""}\n                  ${s.category?`<span class="category">${s.category}</span> | `:""}\n                  <span>${s.title}</span>\n                  ${s.description?`<span>${s.description}</span>`:""}\n              </a>\n              <div class="group-items">\n                  ${n.map((e=>`\n                    <a href="${e.url}" class="algolia-hit-item-link">\n                      <div class="search-result-item">\n                        <div class="search-result-chapter">\n                          ${e.hierarchy_lvl3?`<span>${e._highlightResult.hierarchy_lvl3.value}</span>`:""}\n                          ${e.hierarchy_lvl4?`<span> > ${e._highlightResult.hierarchy_lvl4.value}</span>`:""}\n                          ${e.hierarchy_lvl5?`<span> > ${e._highlightResult.hierarchy_lvl5.value}</span>`:""}\n                        </div>\n                        <div class="search-result-content">\n                          ${e.content?`<span>${e._highlightResult.content.value}</span>`:""}\n                        </div>\n                      </div>\n                    </a>\n                  `)).join("")}\n              </div>\n          </div>\n          `}(t,{html:i,components:s}):"algolia"==e.engine?function(e,{html:t,components:i}){return`\n          <a href="${e.url?e.url:GLOBAL_CONFIG.root+e.path}" class="algolia-hit-item-link">\n          <span class="algolia-hits-item-title">${e._highlightResult.content.value||"no-title"}</span>\n          </a>`}(t,{html:i,components:s}):void 0},empty:function(e){const t=document.querySelector("#algolia-hits .icon-spinner");return console.info(t),t&&(t.style.display="none"),setTimeout((()=>{document.querySelector("#site-search .ais-SearchBox-input").focus()}),200),'<div id="algolia-hits-empty">'+GLOBAL_CONFIG.search.languages.hits_empty.replace(/\$\{query}/,e.query)+"</div>"}},cssClasses:{item:"algolia-hit-item"}}),r=instantsearch.widgets.stats({container:"#search-info > .search-stats",templates:{text:function(e){return`<hr>${GLOBAL_CONFIG.search.languages.hits_stats.replace(/\$\{hits}/,e.nbHits).replace(/\$\{time}/,e.processingTimeMS)}`}}}),o=instantsearch.widgets.pagination({container:"#search-pagination",totalPages:e.hits.per_page??5,templates:{first:'<i class="icon-angle-double-left"></i>',last:'<i class="icon-angle-double-right"></i>',previous:'<i class="icon-angle-left"></i>',next:'<i class="icon-angle-right"></i>'},scrollTo:!1,showFirstLast:!1,cssClasses:{root:"pagination",item:"pagination-item",link:"page-number",active:"current",disabled:"disabled-item"}});s.addWidgets([n,a,l,r,o]),s.start(),window.pjax&&s.on("render",(()=>{window.pjax.refresh(document.getElementById("algolia-hits"))}))};a(),e.addEventListener("click",s),document.querySelector("#site-search .search-close-button").addEventListener("click",s),window.addEventListener("pjax:complete",(()=>{!btf.isHidden(e)&&s(),a()}))}));